<!doctype html>
<html lang="fr">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>AFUP Day du 11/06/2021 - L'architecture hexagonale ... concrètement</title>

	<link rel="stylesheet" href="../revealjs/dist/reset.css">
	<link rel="stylesheet" href="../revealjs/dist/reveal.css">
	<link rel="stylesheet" href="../revealjs/dist/theme/white.css" id="theme">

	<link rel="stylesheet" href="../revealjs/plugin/highlight/monokai.css" id="highlight-theme">

	<link rel="stylesheet" href="../custom/style.css" id="custom-theme">
	<link rel="stylesheet" href="assets/safti.css" id="safti-theme">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h1>L'architecture hexagonale ... concrètement</h1>
				<hr />
				<p>AFUP Day 11/06/2021 - Toulouse</p>
			</section>
			<section>
				<div class="container">
					<img src="assets/safti-ca-le-fait.jpg" alt="SAFTI ça le fait !" width="40%" />
					<div>
						<p>Fred Blanc</p>
						<p><a href="https://github.com/blanc-frederic">github.com/blanc-frederic</a></p>
						<p>Lead dev chez <a href="https://www.safti.fr">SAFTI</a></p>
					</div>
				</div>
			</section>
			<section>
				<h2>Problème</h2>
				<p>- “Ah, si on pouvait utiliser XXX ! ça a l’air trop bien !”</p>
				<p>- “Oui, mais vu tout ce qu’il faudrait réécrire ...”</p>
				<p>&nbsp;</p>
				<p>XXX = nouvelle lib / service / framework</p>
			</section>
			<section>
				<h2>Solution universelle</h2>
				<p><img src="assets/briques.png" alt="briques" /></p>
			</section>
			<section>
				<h2>Version architecture hexagonale</h2>
				<p><img src="assets/ports.jpg" alt="ports" /></p>
			</section>
			<section>
				<h2>Architecture hexagonale</h2>
				<p><img src="assets/hexa.png" alt="hexagon" /></p>
			</section>
			<section>
				<h2>Avantages</h2>
				<ul>
					<li>Choix infrastructure plus tard</li>
					<li class="fragment">Démo plus rapidement</li>
					<li class="fragment">Montées de versions framework et lib plus faciles</li>
					<li class="fragment">Bascule facile vers nouvelles lib / services</li>
					<li class="fragment">Tests plus simples à écrire</li>
				</ul>
			</section>
			<section>
				<h2>Attention</h2>
				<ul>
					<li>un peu plus de code à écrire</li>
					<li class="fragment">outils de génération de code ne fonctionnent pas tous</li>
				</ul>
				<p class="fragment">⇒ à réserver aux applications complexes… ou qui vont le devenir</p>
			</section>
			<section>
				<h2>Exemple</h2>
				<p>Avec Symfony… car + utilisé et s’y prête bien</p>
				<p class="fragment">C'est une <b>des</b> implémentations possibles</p>
			</section>
			<section>
				<h2>Arborescence cible</h2>
				<pre>
	src
	  Domain
	  Infrastructure
				</pre>
			</section>
			<section>
				<h2>Etape 1 : namespaces</h2>
				<p>Modification autoload dans composer.json</p>
				<p><img src="assets/composer.png" alt="changes composer" /></p>
			</section>
			<section>
				<h2>Etape 2 : déplacement du Kernel</h2>
				<p>src/Kernel.php ⇒ src/Infrastructure/Symfony/Kernel.php</p>
				<ol>
					<li>Corriger chemin vers config</li>
					<li>Corriger instanciations dans :
						<ul>
							<li>bin/console</li>
							<li>public/index.php</li>
							<li>.env.test</li>
						</ul>
					</li>
				</ol>
			</section>
			<section>
				<h2>Etape 3 : configuration services</h2>
				<pre><code>
services:

  Domain\:
    resource: '../src/Domain'
    exclude:
      - '../src/Domain/Entity/'

  Infrastructure\:
    resource: '../src/Infrastructure'
    exclude:
      - '../src/Infrastructure/Symfony/Kernel.php'

  Infrastructure\Symfony\Controller\:
    resource: '../src/Infrastructure/Symfony/Controller/'
    tags: ['controller.service_arguments']
				</code></pre>
			</section>
			<section>
				<h2>Le code</h2>
				<div class="container">
					<div>
						<p>Domain</p>
						<ul>
							<li>Organisation métier</li>
							<li>Interface pour chaque besoin</li>
							<li>Tests 100% coverage</li>
						</ul>
					</div>
					<div class="fragment">
						<p>Infrastructure</p>
						<ul>
							<li>Organisation technique</li>
							<li>Implémenter interfaces</li>
						</ul>
					</div>
				</div>
			</section>
			<section>
				<h2>Exemple : Domain</h2>
				<p><img src="assets/domain.png" alt="code domain" /></p>
			</section>
			<section>
				<h2>Exemple : Interface du Domain</h2>
				<p><img src="assets/contract.png" alt="contract" /></p>
			</section>
			<section>
				<h2>Exemple : Infrastructure</h2>
				<p><img src="assets/infra-1.png" alt="code infra" /></p>
			</section>
			<section>
				<h2>Changer l’implémentation</h2>
				<p><img src="assets/infra-2.png" alt="code infra 2" /></p>
			</section>
			<section>
				<h2>Outils</h2>
				<p><b>Deptrac</b> : <a href="https://github.com/qossmic/deptrac">github.com/qossmic/deptrac</a></p>
				<p>Règles :</p>
				<ol>
					<li>Domain n’utilise pas Infrastructure</li>
					<li>Domain n’utilise aucun namespace externe<br> (ex: Symfony, Doctrine, etc.)</li>
				</ol>
			</section>
			<section>
				<h2>Plusieurs contextes</h2>
				<pre>
	src
	  Contexte1
	    Domain
	    Infrastructure
	
	  Contexte2
	    Domain
	    Infrastructure
	
	  [...]
	
	  Shared
	    Infrastructure
				</pre>
			</section>
			<section>
				<h2>Communication entre contextes</h2>
				<ul>
					<li>par API</li>
					<li>par évènement</li>
				</ul>
			</section>
			<section>
				<h2>Couches supplémentaires</h2>
				<pre>
	src
	  Contexte1
	    Application

	    Domain

	    Infrastructure
	      Symfony
	      Doctrine
				</pre>
			</section>
			<section>
				<h2>Legacy ?</h2>
				<ol>
					<li>Créer dossiers Domain et Infrastructure</li>
					<li>Nouvelles fonctionnalités dans hexagonal</li>
					<li>Migration progressive pour l'existant</li>
				</ol>
			</section>
			<section>
				<h2>Merci !</h2>
				<p><a href="https://github.com/blanc-frederic/demo-hexa">github.com/blanc-frederic/demo-hexa</a></p>
				<p>Des questions ?</p>
			</section>
		</div>
	</div>

	<script src="../revealjs/dist/reveal.js"></script>
	<script src="../revealjs/plugin/notes/notes.js"></script>
	<script src="../revealjs/plugin/markdown/markdown.js"></script>
	<script src="../revealjs/plugin/highlight/highlight.js"></script>
	<script>
		Reveal.initialize({
			hash: true,
			transitionSpeed: 'fast',
			plugins: [RevealHighlight],
			allottedTime: 30 * 60 * 1000,
			keyboard: {
				13: () => {
					ElapsedTimeBar.isPaused ? ElapsedTimeBar.resume() : ElapsedTimeBar.pause();
				},
			},
			dependencies: [
				{ src: '../custom/plugin/elapsed-time-bar/elapsed-time-bar.js' }
			]
		});
	</script>
</body>

</html>